[Unit]
Description=Docker registry
After=docker.service
Requires=docker.service

[Service]
Environment=UNIT=docker-registry
TimeoutStartSec=0
ExecStartPre=/usr/bin/docker pull <%= node[:docker][:registry_image] %>
ExecStartPre=-/usr/bin/docker run --name ${UNIT}-dvc -v /tmp/registry busybox true
ExecStartPre=-/usr/bin/docker rm ${UNIT}
ExecStart=/usr/bin/docker run --name ${UNIT} \
  -p 5000:5000 \
  --volumes-from ${UNIT}-dvc \
  <%= node[:docker][:registry_image] %>
ExecStop=/usr/bin/docker stop ${UNIT}
